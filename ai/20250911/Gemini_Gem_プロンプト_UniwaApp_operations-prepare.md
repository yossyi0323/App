# Gemini Gem プロンプト: RestaurantApp operations-prepare アプリケーション再構築

## プロジェクト概要

このプロンプトは、既存の「operations-prepare」アプリケーションを完全に再構築するための包括的な指示書です。現行のアプリケーションは飲食店の翌日営業準備業務を効率化するためのWebアプリケーションで、Next.js + TypeScript + Supabaseの技術スタックで構築されています。

## 1. アプリケーションの目的と背景

### 1.1 業務概要
- **目的**: 飲食店の翌日営業準備業務の効率化
- **対象業務**: 在庫確認、補充（移動・作成）、発注依頼、営業準備状況管理
- **特徴**: 補充元と補充先が分散している環境での補充業務管理
- **デバイス**: スマートフォンファースト（片手操作最適化）

### 1.2 現行アプリケーションの課題

#### 1.2.1 設計・アーキテクチャの根本的な問題
- **抽象度の高い概念設計からの直接実装**: カフェで小一時間で書き上げた「アプリケーション概念設計ノート」を基に、抽象度の高い情報のみで設計・開発・テストを進めた
- **業務フローと機能配置の混同**: 概念設計ノートで考えていた業務をそのままアプリに一対一対応させてしまったが、アプリにはアプリの論理があり、業務をそのまま一対一対応させるのは正解ではない
- **詳細設計の不備**: 業務フローとアプリケーションの詳細設計を混在させた結果、具体的な実装方針が不明確なまま開発が進行

#### 1.2.2 技術スタックの方向性の不一致
- **学習目標との乖離**: 
  - 本来の学習目標: PostgreSQL + Java(SpringBoot) + Vue.js(OptionsAPI) で実務スキル向上
  - 実際の実装: Next.js + Supabase で勢いで開始
- **学習目的の不明確化**: アプリケーションアーキテクトとして新しいアプリをゼロから作り切る経験を通して、仕事で大きなシステムの一部を作っているだけでは携われない課題にぶち当たって勉強・悩み・解決するプロセスを経たいという学習目的が不明確なまま技術選択をした

#### 1.2.3 外部要因による制約
- **Supabaseプラン変更**: 認証認可の再検討が必要
- **純粋なPostgreSQL使用への回帰**: Supabase前提の設計から脱却が必要

#### 1.2.4 技術的負債の蓄積
- **自動保存の仕組みが未完成**: 具体的に詰められない状態で実装まで進行
- **排他制御・同期の仕組みが未検討**: 複数ユーザーからの更新に対する考慮不足
- **アーキテクチャ的な設計の不備**: 根本的な設計検討が不足した状態

## 2. 技術スタック（再構築版）

### 2.1 学習目標に基づく技術選択方針
- **学習目的**: アプリケーションアーキテクトとして新しいアプリをゼロから作り切る経験を通して、仕事で大きなシステムの一部を作っているだけでは携われない課題にぶち当たって勉強・悩み・解決するプロセスを経る
- **技術選択基準**: 実務で使用頻度の高い技術スタックを採用し、深い理解を得る
- **アーキテクチャ**: 保守性・拡張性・学習効果を重視した設計

### 2.2 技術スタック（基本方針のみ確定）
- **フロントエンド**: Vue.js + JavaScript
- **バックエンド**: Java (Spring Boot)
- **データベース**: PostgreSQL
- **その他の技術選択**: ライブラリの選定や詳細な技術スタックは、課題の詳細分析と要件の再整理を通じて決定する

## 3. データベース設計
- **現状**: 概念設計ノートの内容をそのまま実装したが、アプリケーションとして適切でない設計
- **課題**: 機能配置と業務フローの分離を踏まえた適切なデータベース設計が必要
- **決定事項**: 未定（マスタ設計、区分値、テーブル構成すべて再検討が必要）

## 4. 画面設計

### 4.1 設計方針の再検討
- **現状の問題**: 業務フローと機能配置を混同し、業務をそのままアプリに一対一対応させてしまった
- **課題**: アプリにはアプリの論理があり、一画面で複数の業務ができることもあれば、複数画面を使わないとできない1つの業務もある
- **方針**: 機能配置と業務フローを分離し、アプリケーションとして適切な設計・実装を検討する

### 4.2 画面設計
- **現状**: 業務フローと機能配置の混同により、アプリケーションとして適切でない設計になっている
- **課題**: ステータス遷移やUIなども色々変えたいが、具体的な方針が未確定
- **方針**: 機能配置と業務フローを分離し、アプリケーションとして適切な設計・実装を検討する
- **詳細**: 具体的な画面設計は、課題の詳細分析と要件の再整理を通じて決定する

### 4.3 共通レイアウト
- **ヘッダー**: ハンバーガーメニュー、ページタイトル、テーマ切り替え
- **サイドバー**: ナビゲーションメニュー（折りたたみ可能）
- **メインコンテンツ**: 各業務画面のコンテンツエリア
- **デバイス対応**: スマートフォンファースト（ブラウザ・PWA）

## 5. 主要機能仕様

### 5.1 自動保存機能（再設計）
- **現状の問題**: 具体的に詰められない状態で実装まで進行
- **再設計方針**: 
  - **フロントエンド**: Vue.js での状態管理（具体的なライブラリは未定）
  - **バックエンド**: Spring Boot での同期機能（具体的な実装方式は未定）
  - **データベース**: PostgreSQL での排他制御（具体的な方式は未定）
- **保存タイミング**: 要検討
- **排他制御**: 複数ユーザー対応の排他制御（具体的な方式は未定）
- **エラーハンドリング**: 保存失敗時のリトライ機能 + 競合解決

### 5.2 認証機能（再設計）
- **認証方式**: 具体的な認証方式は未定
- **セッション管理**: セッション管理方式は未定
- **認可**: 認可方式は未定
- **認証ガード**: 全ページでの認証チェック

### 5.3 テーマ機能
- **対応テーマ**: ライトモード・ダークモード
- **実装方式**: 具体的な実装方式は未定
- **永続化**: 永続化方式は未定

### 5.4 スマートフォン対応
- **デバイス**: スマートフォンのみ（ブラウザ・PWA）
- **操作最適化**: タッチ操作、片手操作対応
- **画面サイズ**: スマートフォン画面に最適化



## 6. 未解決の技術的課題

### 6.1 自動保存機能の設計
- **現状**: 具体的に詰められない状態で実装まで進行
- **課題**: 複数ユーザーでの排他制御・同期の仕組みが未検討
- **決定事項**: 未定

### 6.2 認証認可の仕組み
- **現状**: Supabase前提の設計から脱却が必要
- **課題**: 純粋なPostgreSQL使用への回帰で認証方式を再検討
- **決定事項**: 未定

### 6.3 画面設計・機能配置
- **現状**: 業務フローと機能配置を混同した設計
- **課題**: 機能配置と業務フローを分離した適切な設計が必要
- **決定事項**: 未定

## 7. 注意事項・制約事項

### 7.1 技術的制約
- **抜本的作り直し**: 実現したい業務は同じだが、作るアプリは全くの別物
- **技術スタック変更**: Next.js + Supabase から Spring Boot + Vue.js + PostgreSQL への変更
- **モバイルファースト**: UI設計は継続してモバイルファーストを維持

### 7.2 業務的制約
- **業務フロー改善**: 機能配置と業務フローの分離を踏まえた適切な設計が必要
- **学習コスト最小化**: 既存ユーザーの操作感を維持しつつ効率化
- **データ整合性**: 排他制御・同期機能の実装による整合性確保

### 7.3 開発制約
- **完全再構築**: 既存コードベースは参考程度に留め、完全に新規構築
- **学習目的重視**: アプリケーションアーキテクトとしてのスキル向上を最優先
- **テスト駆動開発**: TDD + 継続的なリファクタリング
- **アーキテクチャ重視**: 保守性・拡張性を重視した設計

## 8. 再構築の背景・動機

### 8.1 現状の問題点
- **設計の根本的欠陥**: 抽象度の高い概念設計から直接実装に落とし込んだ結果、業務フローと機能配置を混同した設計になってしまった
- **技術スタックの不一致**: 実務スキル向上の学習目標（PostgreSQL + Java + Vue.js）と実際の実装（Next.js + Supabase）が乖離
- **技術的負債の蓄積**: 自動保存・排他制御・同期機能の設計が不十分な状態で実装まで進行

### 8.2 再構築の目的・背景
- **本業との技術スタック統一**: 本業でJavaとVueで開発しているため、学習効果を最大化するために同じ技術スタックで開発したい
- **ゼロからの設計経験**: 本業では既存システムへの追加開発が中心で、既存の仕組みに乗っかるばかりでゼロから仕組みを考える経験が積めない
- **アーキテクトスキル向上**: 仕事ではデータベースの概念設計や画面全体のレイアウトを自分で考える機会がなかなかないため、アプリケーションアーキテクトとして新しいアプリをゼロから作り切る経験を通して、仕事で大きなシステムの一部を作っているだけでは携われない課題にぶち当たって勉強・悩み・解決するプロセスを経りたい
- **業務フローと機能配置の分離**: 業務フローと機能配置を混同した設計を改善し、アプリケーションとして適切な設計・実装を実現
- **技術的負債の解消**: 適切なアーキテクチャ設計による保守性・拡張性の確保

### 8.3 期待される成果
- **アーキテクトスキル向上**: ゼロからアプリケーションを設計・構築する経験
- **課題解決能力向上**: 大きなシステムの一部では経験できない課題への対応力
- **保守性向上**: 適切な設計パターン・アーキテクチャの実装

---



俺からのコメント

@アプリケーション概念設計ノート.md このアプリケーション概念設計ノートという、カフェで小一時間で書き上げた「概ねこんな感じのアプリを作ったら良さそう」というドキュメントをもとにはしりだして、これだけを頼りに設計・開発・テストを進めてきた。
ただ、抽象度高い情報しか含められてないのと、その内容というか、とくに業務フローの部分と、業務フローを実現するためのより具体的なアプリケーションの設計（詳細設定みたいな段階）とをごっちゃにやっちゃったせいで、業務フローと機能が1対1対応してしまっていて、本当なら1画面で2,3の業務が回るものも3画面に分かれている、みたいなことが起きてしまっている。
また、このアプリケーションは、アプリケーションエンジニアとしての私が今後腕を磨いていくなかで、「色々試す」という幅を広げる勉強と、「一つのものを深める」みたいな深さを出す勉強とのうち、深さを出すような進め方をするプロジェクトとして位置づけたい。
色々試す方ではRust使ってみたりWebアセンブリとか使ったり、DBもNoSQL使うみたいなことをしてみたいんだけど、一方で深さを求める方のアプリケーションでは、普段仕事でITコンサルタントとしてFutureで働く中で使っている、PostgreSQL、Java（SpringBoot）、JavascriptとVue.js（OptionsAPI）を中心に、実務にも役立つような腕の磨き方をしたいと思っている。
だが、その方針を決めるよりも前に、このアプリケーション開発を、勢いでNext.jsとSupabaseで始めちゃったせいで、そういう大きな方針にも合わなくなっちゃった。そのうえ、Supabaseのプランが変わっちゃったりもして、純粋にPostgreSQLを使いたいだけなのに、Supabase前提で考えていた認証認可も考え直さなきゃいけなくなっちゃった。
また、自動保存の仕組みがあんまり具体的に詰められてない状態で実装まで来ちゃったのも問題だし、複数ユーザーからの更新のような、排他制御や同期の仕組みも含めて、あんまりちゃんと考えられてない。アーキテクチャ的な部分だよね。
そんなわけで、色々考えたら作り直すほうがいいなとなったわけ。