# AI Collaboration & Handover Protocol

## Purpose
Enable seamless collaboration between AI agents across multiple machines (Mini-PC and Tablet-PC) without user intervention in the handover process.

## Log Location

**Mini-PC:** `C:\Users\yoshi\Documents\App\ai\{yyyyMMdd}.log`
**Tablet-PC:** `C:\Users\YOSHITO\Documents\App\ai\{yyyyMMdd}.log`

例：
- `20251027.log` - 2025年10月27日のログ
- `20251028.log` - 2025年10月28日のログ
- `latest.md` - 最新状態のクイックサマリー（オプション）

**Note:** User folder name differs between machines. Both paths are valid.

## Core Principles

1. **Autonomous Logging**: Write to daily log file continuously during work, like application.log
2. **Honest Communication**: Be frank about code quality, risks, and concerns
3. **Context Preservation**: Ensure next AI can pick up exactly where you left off
4. **User-Independent**: User doesn't read logs; this is AI-to-AI communication
5. **Incremental Updates**: Append to log throughout session, not just at end
6. **Daily Separation**: Each day gets its own log file for better organization

## Machine Sync Protocol

### Git Synchronization Responsibility

**User manages ALL Git operations:**
- User performs `git add`, `git commit`, `git push`, `git pull`
- User handles merge conflicts
- User decides when and what to commit
- User manages branching strategy

**AI responsibilities:**
- **DO NOT** run any git commands (add/commit/push/pull/status) unless explicitly asked
- **DO NOT** suggest "let's commit this"
- **DO NOT** assume code is out of sync
- **ONLY** provide git command examples when user asks "how do I...?"
- User has already synced - trust that working tree is current

### Reading Changes After Sync

When user says "同期した" or similar, AI should:

1. **Read today's AI log first**
   ```powershell
   # Read ai/{yyyyMMdd}.log to understand context
   ```

2. **Check recent Git commits to see what changed**
   ```powershell
   git log --oneline -5 --name-status
   ```
   This shows:
   - Recent commit messages
   - Files added/modified/deleted
   - What the other AI worked on

3. **Understand the handover**
   - What was completed?
   - What files were changed?
   - What's the next priority?
   - Any blockers or concerns?

### What NOT to do

- ❌ Don't run `git pull` (user already synced)
- ❌ Don't run `git status` and worry about "uncommitted changes" (user manages commits)
- ❌ Don't suggest committing every change immediately
- ❌ Don't assume you need to clean up Git state

### What TO do

- ✅ Read ai.log to understand context
- ✅ Run `git log` to see what changed
- ✅ Trust that user has synced properly
- ✅ Continue from where the other AI left off

## Session Start Protocol

### 1. Read Latest State (Mandatory)
```
1. 現在の日付を取得（Get-Date -Format "yyyyMMdd"）
2. 当日のログファイル（{yyyyMMdd}.log）を読み込み
3. 必要に応じて前日・前々日のログも参照

理解すること:
- What was the last AI working on?
- What decisions were made?
- What concerns exist?
- What's the next priority?
```

### 2. Announce Session Start
```
[YYYY-MM-DD HH:MM:SS] SESSION START
Machine: [Mini-PC/Tablet-PC]
Agent: Cursor AI
Previous session ended: [timestamp from log]
Resuming from: [brief context]
```

## During Work Protocol

### Log Everything Important
Write to ai.log immediately when:
- Making architectural decisions
- Discovering code issues
- Implementing features
- Running into blockers
- Having concerns about user's request
- Finding better approaches
- Completing milestones

### Log Format (Flexible)
```
[YYYY-MM-DD HH:MM:SS] [CATEGORY] Message
```

Categories:
- `DECISION`: Technical decision made
- `CONCERN`: Risk or code quality issue
- `PROGRESS`: Work completed
- `BLOCKER`: Something preventing progress
- `TODO`: New task identified
- `QUESTION`: Unclear user intent
- `REFACTOR`: Code that needs improvement
- `TEST`: Test results
- `NOTE`: General observation

### Example Entries
```
[2025-10-27 14:23:15] DECISION Chose楽観的ロック for inventory_status table. Reason: Low concurrent access expected, simpler than pessimistic. Future社ガイドライン recommends this.

[2025-10-27 14:45:32] CONCERN User wants "自動保存" but unclear if they want debounce like operations-prepare (3sec). Need to clarify but proceeding with 3sec assumption.

[2025-10-27 15:12:08] PROGRESS Implemented AutoSaveManager Vue3 version in lib/utils/auto-save.ts. Based on operations-prepare design but adapted for Composition API.

[2025-10-27 15:45:00] REFACTOR InventoryStatusService needs refactoring - too many responsibilities. Should split into InventoryQueryService and InventoryCommandService.

[2025-10-27 16:20:13] BLOCKER Can't proceed with authentication implementation until user decides: Google OAuth vs email/password. Added to TODO.md.
```

## Session End Protocol

### 1. Write Summary
```
[YYYY-MM-DD HH:MM:SS] SESSION END
Duration: [duration]
Commits: [commit hashes]
Files modified: [list]
Tests: [pass/fail/not run]

Summary of work:
- [What was accomplished]
- [Decisions made]
- [Issues discovered]

Top concerns for next AI:
1. [Most critical concern]
2. [Second concern]
3. ...

Immediate next steps:
1. [Highest priority task]
2. [Second priority]
3. ...

Context notes:
- [Important context next AI needs]
- [Assumptions made that need validation]
```

### 2. Update latest.md (Optional Quick Reference)
Create/update `ai-handover/latest.md` with condensed current state for quick scanning.

## Inter-AI Communication Guidelines

### Be Brutally Honest
- Call out code smells directly
- Point out potential bugs
- Suggest refactoring without sugar-coating
- Challenge architectural decisions if questionable

### Provide Context, Not Just Facts
BAD:
```
[2025-10-27 14:23:15] DECISION Using UUID v7
```

GOOD:
```
[2025-10-27 14:23:15] DECISION Using UUID v7 for all entity IDs. Reason: operations-prepare used this, provides time-ordered IDs for better DB performance, Future社ガイドライン recommends. Trade-off: slightly larger than BIGINT but negligible for this app scale.
```

### Mark Uncertainty
When user's intent is unclear:
```
[2025-10-27 15:30:00] QUESTION User said "ちゃんと動くようにして" - interpreting as "ensure all tests pass + fix linter errors". If wrong, next AI should clarify with user.
```

### Cross-Reference Documents
```
[2025-10-27 14:45:00] NOTE See operations-prepare/docs/auto-save-design.md for original design philosophy. Adapting to Vue3 but keeping core principles (debounce, dirty tracking, LocalStorage backup).
```

## Continuous Improvement

### Review & Adapt
Every ~10 sessions, one AI should:
1. Review ai.log effectiveness
2. Propose protocol improvements
3. Write suggestions in log with `[PROTOCOL]` tag

### Example
```
[2025-11-05 10:00:00] PROTOCOL After 15 sessions, noticed we're logging too much low-level detail. Suggest: only log decisions/concerns/blockers, skip routine progress updates. What do you think, next AI?
```

## File Operations

### How to Write to AI Log

**DO NOT use PowerShell echo commands.** Use file operation tools instead.

**Correct method:**
1. Get current date: `Get-Date -Format "yyyy-MM-dd HH:mm:ss"`
2. Read existing log: `read_file` tool on `ai/{yyyyMMdd}.log`
3. Append new entries to the content
4. Write back: `write` tool to save the updated log

**Example workflow:**
```
# Mini-PC
1. read_file: C:\Users\yoshi\Documents\App\ai\20251027.log
2. Add your log entries to the content
3. write: Save the complete updated content

# Tablet-PC
1. read_file: C:\Users\YOSHITO\Documents\App\ai\20251027.log
2. Add your log entries to the content
3. write: Save the complete updated content
```

**Why NOT PowerShell echo:**
- ❌ Requires escaping special characters (backticks, quotes)
- ❌ Hard to read and maintain
- ❌ Error-prone with multiline content
- ✅ File tools are cleaner and more reliable

### Read Log
- 当日のログファイルを全行読み込み（通常は数百行程度）
- 必要に応じて前日・前々日のログも参照

## Integration with Existing Rules

This protocol works alongside:
- `base-rule.mdc`: Development rules
- `date-awareness.mdc`: Date handling rules
- `no-emoji-usage.mdc`: No emoji in responses
- `obsidian-docs-placement.mdc`: Document organization

## User Interaction

User doesn't need to:
- Read ai.log
- Manage handover process
- Coordinate between machines

User may:
- Check if collaboration is working well
- Request improvements if needed
- Ignore the logs entirely if preferred

## Summary

**Core Loop:**
1. Start session → Read today's log file (and recent days if needed)
2. During work → Log decisions/concerns/progress incrementally to today's log
3. End session → Write summary
4. Next AI repeats

**Success Metric:**
Next AI can seamlessly continue work without asking user "what was I working on?" or "why was this decision made?"

**Log Organization:**
- Each day = one log file (`yyyyMMdd.log`)
- Easy to find specific day's activity
- No single file becomes too large

---

**Note to AIs**: This is YOUR space. Communicate honestly and efficiently. If this protocol isn't working, evolve it. User trusts you to make it work.
