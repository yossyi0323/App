---
description: git commitメッセージ作成時のルール
---

# git commitメッセージ作成時のルール

## 目的

CursorのAIにgit操作のためのcommitメッセージの考案を依頼する際のルールを定義する。

**重要：** 
- **開発用ブランチでは、AIが実際にコミットを実行する**（git-workflow.mdc参照）
- **mainブランチでは、AIはコミットメッセージの文字列を提案するだけで、実際のgit操作（commit）はユーザーが行う**
- **コミットメッセージは必ず「feat: 変更内容」形式に統一する**（VS CodeのAI Commit Message機能を使う場合も含む）

---

## 基本原則

### 1. 日本語で記述する

commitメッセージは基本日本語で記述する。

### 2. 形式は「feat: 変更内容」

commitメッセージは以下の形式で記述する：

```
feat: 変更内容
```

**プレフィックスの種類（Conventional Commits準拠）：**
- `feat:`：新機能の追加
- `fix:`：バグ修正
- `docs:`：ドキュメントの変更
- `style:`：コードスタイルの変更（動作に影響しない）
- `refactor:`：リファクタリング
- `perf:`：パフォーマンス改善
- `test:`：テストの追加・変更
- `chore:`：ビルドプロセスやツールの変更
- `ci:`：CI設定の変更
- `build:`：ビルドシステムの変更
- `revert:`：コミットの取り消し

変更内容に応じて適切なプレフィックスを選択する。

### 3. 文字数制限

commitメッセージは短文から長くても30文字程度に収める。

**良い例（作業パターン別）：**

**新機能追加（feat:）：**
- `feat: ユーザー認証機能を追加`
- `feat: パスワードリセット機能を追加`
- `feat: メール通知機能を実装`
- `feat: 検索機能を追加`
- `feat: ファイルアップロード機能を追加`
- `feat: ダッシュボード分析機能を追加`
- `feat: APIレート制限機能を実装`
- `feat: リアルタイム更新機能を追加`
- `feat: CSVエクスポート機能を追加`
- `feat: ダークモード機能を実装`

**バグ修正（fix:）：**
- `fix: ログイン時のエラーハンドリングを修正`
- `fix: メモリリークを修正`
- `fix: 競合状態を修正`
- `fix: SQLインジェクション対策を追加`
- `fix: CORSエラーを修正`
- `fix: タイムアウト問題を修正`
- `fix: バリデーション不具合を修正`
- `fix: UIレイアウト不具合を修正`
- `fix: ページネーションエラーを修正`
- `fix: 日付フォーマット不具合を修正`

**リファクタリング（refactor:）：**
- `refactor: APIレスポンス処理を共通化`
- `refactor: データベースクエリを最適化`
- `refactor: コンポーネント構造を整理`
- `refactor: エラーハンドリングを改善`
- `refactor: 状態管理をリファクタリング`
- `refactor: APIクライアントを共通化`
- `refactor: バリデーションロジックを整理`
- `refactor: テストユーティリティを改善`
- `refactor: 設定管理をリファクタリング`
- `refactor: キャッシュ戦略を改善`

**ドキュメント更新（docs:）：**
- `docs: アーキテクチャ決定記録を追加`
- `docs: APIドキュメントを更新`
- `docs: セットアップガイドを追加`
- `docs: デプロイメントガイドを更新`
- `docs: コントリビューションガイドを追加`
- `docs: トラブルシューティングを追加`
- `docs: ユーザーマニュアルを更新`
- `docs: 開発ワークフローを追加`
- `docs: セキュリティポリシーを更新`
- `docs: パフォーマンス最適化を追加`

**その他：**
- `style: コードフォーマットを統一`
- `test: 認証機能のE2Eテストを追加`
- `test: APIクライアントのユニットテストを追加`
- `perf: データベースクエリを最適化`
- `perf: 画像最適化を実装`
- `perf: バンドルサイズを削減`
- `chore: 依存関係を更新`
- `chore: ビルド設定を更新`
- `chore: CIパイプラインを更新`
- `ci: GitHub Actionsワークフローを追加`
- `build: ビルドシステムを更新`
- `revert: コミットabc123を取り消し`

**悪い例：**
- `feat: ユーザー認証機能を追加し、ログイン画面とパスワードリセット機能も実装した`（長すぎる）
- `fix: バグ修正`（具体的でない）
- `update`（プレフィックスがない）

### 4. git add済みの変更のみを対象とする

**最重要：commitメッセージは、`git add`でステージング済みの変更のみを基に作成する。**

**理由：**
- `git add`していない変更は、まだコミットに含めるかどうか未確定
- 別のコミットに分けたい意図がある可能性がある
- ステージング済みの変更のみが、今回のコミットに含まれる内容

**実行手順：**
1. `git status`でステージング済みの変更を確認
2. `git diff --cached`でステージング済みの変更内容を確認
3. ステージング済みの変更のみを基にcommitメッセージを作成
4. `git diff`（ステージング前の変更）は参照しない

**悪い例：**
- ステージング前の変更も含めてcommitメッセージを作成
- `git diff`の結果を基にcommitメッセージを作成

**良い例：**
- `git diff --cached`の結果のみを基にcommitメッセージを作成
- ステージング済みの変更のみを説明するメッセージ

---

## commitメッセージ作成時の確認事項

1. **ステージング済みの変更を確認したか？**
   - `git status`で確認
   - `git diff --cached`で内容を確認

2. **ステージング前の変更を参照していないか？**
   - `git diff`は参照しない
   - ワークツリーの変更は無視する

3. **適切なプレフィックスを選択したか？**
   - 変更内容に応じたプレフィックスを使用

4. **文字数制限を守っているか？**
   - 30文字程度に収まっているか

5. **日本語で記述しているか？**
   - 基本日本語で記述

---

## 実行例

### ユーザーの依頼

「commitメッセージを作成して」

### AIの実行手順

1. `git status`を実行してステージング済みの変更を確認
2. `git diff --cached`を実行して変更内容を確認
3. 変更内容を分析して適切なプレフィックスを選択
4. 30文字程度の日本語メッセージを作成
5. **コピーできる形で文字列を提供**（実際のcommit操作はユーザーが行う）

### 出力例

コピーできる形で文字列を提供：

```
feat: ユーザー認証機能を追加
```

または

```
fix: ログイン時のエラーハンドリングを修正
```

**注意：** コードブロック内の文字列をそのままコピーして使用できる形式で提供する。

---

## 重要な注意事項

- **絶対にステージング前の変更を参照しない**
- **`git diff --cached`のみを使用する**
- **ステージング済みの変更のみを説明する**
- **ユーザーが意図的に分けたいコミットを混ぜない**

---

## AIによる能動的なコミット（開発用ブランチ）

### 基本方針

**目的：** 開発用ブランチで適切な単位でコミットし、履歴を明確にする

**役割：** AIは開発用ブランチ上で、作業の区切りで積極的にコミットを実行する

**重要：** ユーザーは「タイミングを考えるのが手間」「忘れがちでDiffが溜まると見づらい」と感じているため、**積極的に都度都度コミットする**ことが求められている。

**詳細は`git-workflow.mdc`を参照**

### コミットのタイミング（積極的にコミット）

**必ずコミットすべき場面：**

1. **作業の区切りがついた時**
   - 1つの機能や修正が完了した時
   - ドキュメント更新が完了した時
   - リファクタリングが完了した時
   - テストが追加・修正された時
   - **ルールファイルを更新した時**
   - **セッションログを記録した時**

2. **変更が積み重なった時**
   - 2-3個以上のファイルを変更した時（3-5個を待たない）
   - 関連する変更がまとまった時

3. **作業セッションの終了時**
   - ユーザーが「今日はここまで」と言った時
   - セッション終了の合図があった時

4. **定期的な確認**
   - 作業中に`git status`を確認し、変更があればコミットを検討
   - **判断に迷ったら、積極的にコミットする**（小さなコミットは問題ない）

### コミットの手順

1. **変更内容を確認**
   - `git status`で変更されたファイルを確認
   - `git diff`で変更内容を確認

2. **ステージング**
   - 関連する変更をまとめてステージング
   - 無関係な変更は分けてステージング

3. **コミットメッセージを作成**
   - 変更内容を分析
   - 適切なプレフィックスを選択
   - 30文字程度の日本語メッセージを作成

4. **コミット実行**
   - `git commit -m "feat: 変更内容"` を実行

## mainブランチでのコミットメッセージ提案

### 基本方針

**mainブランチでは、AIはコミットメッセージの文字列を提案するだけで、実際のgit操作（commit）はユーザーが行う**

**提案のタイミング：**
- ユーザーが明示的にコミットメッセージの作成を依頼した時
- ユーザーがステージング済みの変更についてコミットメッセージを求めている時

**提案の方法：**
- コミットメッセージをコピーできる形で提示
- Git操作（commit）は提案しない、メッセージの考案のみ

## まとめ

commitメッセージ作成時は：
1. 日本語で記述
2. 「feat: 変更内容」形式
3. 30文字程度に収める
4. **`git add`済みの変更のみを対象とする**
5. ステージング前の変更は参照しない
6. **コピーできる形で文字列を提供する**（実際のcommit操作はユーザーが行う）

**AIによる能動的な提案：**
- 作業の区切りでコミットを提案する
- 変更内容を確認し、適切なコミットメッセージを提案する
- ユーザーが選択できる余地を残す
