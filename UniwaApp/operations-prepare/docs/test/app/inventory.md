# 在庫確認画面 テスト仕様書

## 1. テスト概要

在庫確認画面の各機能が設計書の仕様通りに動作し、**テストカバレッジ100%を担保する**ことを目的とする。

## 2. テストケース

### 2.1 補充先選択機能

#### 2.1.1 補充先の表示

| 確認条件                     | 想定結果                                                                                       |
| ---------------------------- | ---------------------------------------------------------------------------------------------- |
| 補充先が選択されていない場合 | Infoレベルのメッセージ「補充先を選択してください」が表示される                                 |
| 補充先を選択した場合         | 選択した補充先に紐づく品物のみが表示される                                                     |
| 補充先を変更した場合         | 変更前の品物の入力値がinventory_statusテーブルに保存され、新しい補充先の品物リストが表示される |

#### 2.1.2 補充先の件数表示

| 確認条件                         | 想定結果                         |
| -------------------------------- | -------------------------------- |
| 未確認の品物がある場合           | 未確認の件数バッジが表示される   |
| 確認済の品物がある場合           | 確認済の件数バッジが表示される   |
| 確認不要の品物がある場合         | 確認不要の件数バッジが表示される |
| 品物のステータスが変更された場合 | 件数バッジが更新される           |

### 2.2 品物カードの基本機能

#### 2.2.1 品物情報の表示

| 確認条件                   | 想定結果                                                 |
| -------------------------- | -------------------------------------------------------- |
| 品物カードが表示された場合 | 品目名、在庫数、補充数、補充ステータス入力欄が表示される |

#### 2.2.2 在庫数入力

| 確認条件                     | 想定結果                     |
| ---------------------------- | ---------------------------- |
| 在庫数を入力した場合         | 値が正しく保存される         |
| 在庫数に負の値を入力した場合 | 0として保存される            |
| 在庫数が空の場合             | 0として保存される            |
| 在庫数が変更された場合       | LocalStorageに自動保存される |

#### 2.2.3 補充数入力

| 確認条件                     | 想定結果                               |
| ---------------------------- | -------------------------------------- |
| 補充数を入力した場合         | 値が正しく保存される                   |
| 補充数に負の値を入力した場合 | 0として保存される                      |
| 補充数が空の場合             | 0として保存される                      |
| 補充数が1以上の場合          | 補充ステータスが自動で「要補充」になる |
| 補充数が0の場合              | 補充ステータスは「補充不要」のまま     |

#### 2.2.4 補充ステータス

| 確認条件                                                               | 想定結果                           |
| ---------------------------------------------------------------------- | ---------------------------------- |
| 補充ステータスを「要補充」にした場合                                   | 値が正しく保存される               |
| 補充ステータスを「補充不要」にした場合                                 | 値が正しく保存される               |
| 補充ステータスが「要補充」の場合                                       | 補充数が0でも「要補充」のまま      |
| 補充パターンが「作成」の品物で補充ステータスが「要補充」になった場合   | 作成ステータスも「要作成」になる   |
| 補充パターンが「作成」の品物で補充ステータスが「補充不要」になった場合 | 作成ステータスも「作成不要」になる |

#### 2.2.5 メモ機能

| 確認条件             | 想定結果                     |
| -------------------- | ---------------------------- |
| メモを開いた場合     | メモ入力欄が表示される       |
| メモを閉じた場合     | メモ入力欄が非表示になる     |
| メモを入力した場合   | 値が正しく保存される         |
| メモが変更された場合 | LocalStorageに自動保存される |

### 2.3 自動保存機能

#### 2.3.1 保存タイミング

| 確認条件                       | 想定結果                 |
| ------------------------------ | ------------------------ |
| 入力欄からカーソルが外れた場合 | LocalStorageに保存される |
| 5秒間入力がない場合            | LocalStorageに保存される |
| 30秒間入力がない場合           | LocalStorageに保存される |
| 再度入力を始めるまで           | 2回目の保存は行われない  |

### 2.4 エラー・バリデーション

| 確認条件         | 想定結果                           |
| ---------------- | ---------------------------------- |
| データ取得失敗時 | エラーメッセージが表示される       |
| 必須項目未入力時 | Infoレベルのメッセージが表示される |

## 3. テストデータ

### 3.1 モックデータ（複数パターン）

```typescript
const mockPlaces = [
  { place_id: '1', place_name: '補充先A', place_type: 'DESTINATION' },
  { place_id: '2', place_name: '補充先B', place_type: 'DESTINATION' },
];
const mockItems = [
  { item_id: '1', item_name: '商品A' },
  { item_id: '2', item_name: '商品B' },
];
const mockStatuses = [
  {
    inventory_status_id: '1',
    business_date: '2024-03-20',
    item_id: '1',
    check_status: 'unchecked',
    replenishment_status: 'not-required',
    current_stock: 0,
    replenishment_count: 0,
    memo: '',
  },
  {
    inventory_status_id: '2',
    business_date: '2024-03-20',
    item_id: '2',
    check_status: 'checked',
    replenishment_status: 'needs-restock',
    current_stock: 5,
    replenishment_count: 2,
    memo: '補充必要',
  },
];
```

## 4. テスト実行・カバレッジ取得手順

1. `npm test -- --coverage`でテストを実行し、カバレッジレポートを取得
2. カバレッジレポート（`coverage/lcov-report/index.html`）で100%を確認
3. 未カバー箇所があればテストケース・テストコードを追加

## 5. 注意事項

- テスト実行前にLocalStorageをクリアする
- テストデータは都度リセットする
- 非同期処理の完了を待ってから結果を確認する
- **カバレッジ100%を維持すること**

## 更新履歴

- 2024-03-20: 初版作成
- 2024-06-xx: カバレッジ100%運用・テストデータ拡充・ケース追加
