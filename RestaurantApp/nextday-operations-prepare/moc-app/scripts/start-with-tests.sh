#!/bin/bash

echo "­ЪДф УхитІЋтЅЇсЃєсѓ╣сЃѕт«ЪУАїжќІтДІ..."

# сЃљсЃЃсѓ»сѓесЃ│сЃЅсЃєсѓ╣сЃѕт«ЪУАї
echo "­ЪЊд сЃљсЃЃсѓ»сѓесЃ│сЃЅсЃєсѓ╣сЃѕт«ЪУАїСИГ..."
cd backend
mvn test
if [ $? -eq 0 ]; then
    echo "РюЁ сЃљсЃЃсѓ»сѓесЃ│сЃЅсЃєсѓ╣сЃѕт«їС║є"
else
    echo "РЮї сЃљсЃЃсѓ»сѓесЃ│сЃЅсЃєсѓ╣сЃѕтц▒ТЋЌ - УхитІЋсѓњСИГТГбсЂЌсЂЙсЂЎ"
    exit 1
fi

# сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅсЃєсѓ╣сЃѕт«ЪУАї
echo "­Ъїљ сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅсЃєсѓ╣сЃѕт«ЪУАїСИГ..."
cd ../frontend
npm run test -- --run
if [ $? -eq 0 ]; then
    echo "РюЁ сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅсЃєсѓ╣сЃѕт«їС║є"
else
    echo "РЮї сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅсЃєсѓ╣сЃѕтц▒ТЋЌ - УхитІЋсѓњСИГТГбсЂЌсЂЙсЂЎ"
    exit 1
fi

echo "­ЪјЅ тЁесЃєсѓ╣сЃѕт«їС║є№╝ЂсѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│сѓњУхитІЋсЂЌсЂЙсЂЎ..."

# сЃљсЃЃсѓ»сѓесЃ│сЃЅУхитІЋ№╝ѕсЃљсЃЃсѓ»сѓ░сЃЕсѓдсЃ│сЃЅ№╝Ѕ
echo "­Ъџђ сЃљсЃЃсѓ»сѓесЃ│сЃЅУхитІЋСИГ..."
cd ../backend
mvn spring-boot:run &
BACKEND_PID=$!

# сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅУхитІЋ№╝ѕсЃљсЃЃсѓ»сѓ░сЃЕсѓдсЃ│сЃЅ№╝Ѕ
echo "­Ъїљ сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅУхитІЋСИГ..."
cd ../frontend
npm run dev &
FRONTEND_PID=$!

echo "РюЁ сѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│УхитІЋт«їС║є№╝Ђ"
echo "сЃљсЃЃсѓ»сѓесЃ│сЃЅ: http://localhost:8080"
echo "сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅ: http://localhost:3000"
echo ""
echo "ухѓС║єсЂЎсѓІсЂФсЂ» Ctrl+C сѓњТі╝сЂЌсЂдсЂЈсЂасЂЋсЂё"

# сЃЌсЃГсѓ╗сѓ╣ухѓС║єсЂ«сЃЈсЃ│сЃЅсЃфсЃ│сѓ░
trap "echo 'сѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│сѓњухѓС║єсЂЌсЂЙсЂЎ...'; kill $BACKEND_PID $FRONTEND_PID; exit" INT

# сЃЌсЃГсѓ╗сѓ╣сЂ«уЏБУдќ
wait
