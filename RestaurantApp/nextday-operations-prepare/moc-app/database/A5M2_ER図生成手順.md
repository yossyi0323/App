# A5:SQL Mk-2 でER図生成手順

## 概要
A5:SQL Mk-2を使って、PostgreSQLデータベースから自動的にER図を生成します。

## 前提条件
- A5:SQL Mk-2がインストール済み
- PostgreSQLデータベース `operations_prepare_moc` が作成済み
- テーブルとデータが投入済み

## 手順

### 1. A5:SQL Mk-2を起動

### 2. データベースに接続
1. メニューバーから「データベース」→「データベースの追加と削除」
2. 「追加」ボタンをクリック
3. 接続情報を入力：
   - **データベースの種類**: PostgreSQL
   - **ホスト**: localhost
   - **ポート**: 5432
   - **データベース名**: operations_prepare_moc
   - **ユーザー**: postgres
   - **パスワード**: （設定したパスワード）
4. 「テスト接続」で確認
5. 「OK」で保存

### 3. ER図を自動生成
1. メニューバーから「ファイル」→「新規作成」→「ER図」を選択
2. 空白のER図エディタが開く
3. メニューバーから「**ER図**」→「**データベースとの同期処理(R)...**」を選択
4. 「ER図とデータベースの同期(DB→ER図)」ダイアログが開く
5. 設定を確認：
   - **対象データベース**: `localhost/operations_prepare_moc`
   - **対象スキーマ**: `public`
   - 「データベースのコメントの扱い」: 論理名とコメントとして使用する
6. 「**同期**」ボタンをクリック
7. 全テーブルとリレーションシップ（外部キー）が自動的にER図に追加される

### 4. ER図を整形
- テーブルを見やすい位置にドラッグ＆ドロップで配置
- リレーションシップ（外部キー）の線が自動的に表示される
- 必要に応じてテーブルをグループ化

### 5. ER図を保存
1. メニューバーから「ファイル」→「名前を付けて保存」
2. ファイル名: `operations_prepare_moc_ER図.a5er`
3. 保存場所: `database/` ディレクトリ

### 6. 画像として出力（オプション）
1. メニューバーから「ファイル」→「エクスポート」→「画像ファイル」
2. PNG形式で保存
3. Obsidianドキュメントに貼り付け可能

## 現在のテーブル構成

moc-appのテーブル：
- **item** - 品物マスタ
- **place** - 場所マスタ（補充元・補充先）
- **inventory_status** - 在庫ステータス
- **item_replenishment** - 品物別補充設定
- **item_preparation** - 品物別作成設定
- **reservation** - 予約情報
- **reservation_status** - 予約ステータス

## リレーションシップ

- `inventory_status.item_id` → `item.id`
- `item_replenishment.item_id` → `item.id`
- `item_replenishment.source_location_id` → `place.id`
- `item_replenishment.destination_location_id` → `place.id`
- その他

## メリット

- **自動生成**：手動で書く必要なし
- **常に最新**：DBスキーマ変更後、再生成すればOK
- **視覚的にわかりやすい**：テーブル関係が一目瞭然
- **ドキュメント化**：画像出力してObsidianに貼れる

## 補足：テーブル定義書の作成

ER図より詳細なテーブル定義書（Excel/HTML）も作成できます：

1. 左側のツリーから「operations_prepare_moc」を選択
2. メニューバーから「テーブル」→「テーブル定義書の作成(S)...」
3. 出力形式を選択（Excel推奨）
4. 生成するテーブルを選択
5. 保存先を指定して生成

**テーブル定義書の内容：**
- テーブル名
- 各カラムの名前、型、NULL可否、デフォルト値
- 主キー、外部キー、インデックス
- テーブル・カラムのコメント

## 次のステップ

- [ ] ER図を定期的に更新（スキーマ変更時）
- [ ] Obsidianのドキュメントに貼り付け
- [ ] テーブル定義書も作成（より詳細なドキュメント）



