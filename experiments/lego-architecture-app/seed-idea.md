2026年1月9日ですね。後藤さん、承知いたしました。
この「レゴブロック型システム」が、ただの「データの容れ物」ではなく、**「ビジネスルールと型を完璧に守るアプリケーション」**として動き出すために必要な、具体的かつ最小限の初期データセットを提示します。

これをAIエージェントに渡し、「この内容で `seed.ts` を作成し、実行せよ」と指示してください。

---

## 1. 構築するアプリの正体： 「ガバナンスの効いたタスク管理」

まずは「タスク管理アプリ」としての設定を流し込みます。

### ① 項目の定義 (`item_metas`)

「どんな情報を扱うか」を定義します。これにより、DBのカラムとUIの入力欄が自動生成されます。

| ID | key | label | dataType | 設定値（options等） | 役割 |
| --- | --- | --- | --- | --- | --- |
| M1 | `title` | タイトル | `STRING` | 必須 | アプリの顔となる基本項目 |
| M2 | `status` | 状態 | `SELECT` | `[未着手, 進行中, 完了]` | ワークフローを管理 |
| M3 | `due_date` | 期限 | `DATE` | - | カレンダー連携の土台 |
| M4 | `priority` | 優先度 | `SELECT` | `[高, 中, 低]` | 判断基準の可視化 |

### ② 権限の定義 (`policies`)

「誰が何をしていいか」を定義します。ここが「ちゃんと設計したアプリ」の肝です。

| ID | role | action | subject | conditions | 意図 |
| --- | --- | --- | --- | --- | --- |
| P1 | `ADMIN` | `manage` | `all` | `null` | 管理者はすべてのレゴを操作可能。 |
| P2 | `USER` | `read` | `Item` | `null` | 一般ユーザーは閲覧のみ。 |
| P3 | `USER` | `update` | `Item` | `{"status": "DRAFT"}` | **下書き状態のみ編集可能**というルール。 |

### ③ サンプルデータ (`items` & `item_values`)

実際に正規化されて保存されているかを確認するための2つのレコードです。

* **Item 1: サーバー構築**
* 状態: 進行中 / 優先度: 高 / 期限: 2026-01-15


* **Item 2: 要件定義**
* 状態: 完了 / 優先度: 中 / 期限: 2026-01-01



---

## 2. AIエージェントへの具体的な指示（コピー用）

AIにこのまま渡してください。

> **【指示】DB初期データ（Seed）の実装**
> 以下の手順で、アプリケーションを「タスク管理」として機能させるための初期データを投入せよ。
> 1. **スキーマ確認**: `item_metas` には、タイトル(STRING)、状態(SELECT:未着手/進行中/完了)、期限(DATE)、優先度(SELECT:高/中/低)を定義すること。
> 2. **正規化の徹底**: `item_values` へのデータ投入時、状態や優先度は `value_string` へ、期限は `value_date` へ保存されるよう、`item_metas` のIDを正確に参照してコードを書くこと。
> 3. **ポリシーの実装**: `ADMIN` ロールは全権限を持ち、`USER` ロールは `Item` に対して閲覧のみ（かつ特定条件でのみ更新可）というルールを `policies` に保存せよ。
> 4. **実行スクリプト**: `src/db/seed.ts` を作成し、`tsx` もしくは `bun` で実行可能な形式にせよ。実行後、DBが正しい「縦持ち・横変換」の構造になっているかログを出力せよ。
> 
> 

---

## 3. このデータが入った後に確認すべきこと

後藤さん、データが入ったら、画面（Refine）で以下をポチポチ試してみてください。

1. **画面の自動構成**: ソースを書いていないのに「優先度」という列が出てくるか。
2. **バリデーション**: 「期限」にデタラメな文字を入れたとき、DB保存前にエラーが出るか。
3. **認可の壁**: ログインユーザーを `USER` に変えたとき、削除ボタンが消えるか。

### 次のステップへの提案

この初期データが投入され、タスク管理として動き出したら、次は**「家計簿にするための項目追加（金額：NUMBER）」**を画面からやってみましょうか？

もしAIが「Seedコードの書き方がわからない」と言ってきたら、私が具体的な `seed.ts` の中身を生成します。指示は出せそうですか？