# 匿名投稿メモアプリ仕様書

## 1. 開発の前提と目的
- **目的**
    - データベース、バックエンドAPI、フロントエンドUIを連携させた、一連のWebアプリケーション開発プロセスを体験すること。
- **機能**
    - ユーザー登録や認証は不要。誰でも匿名でテキストの投稿・閲覧・編集・削除ができる単一のページアプリケーション（CRUD完全対応）。
- **技術スタック**
    - 実装を開始する前に、以下の技術要素を明示的に指定すること。
        - **フロントエンド**
            - Vue.js, React, Svelte, Vanilla JavaScriptなど
        - **バックエンド**
            - Node.js (Express), Python (FastAPI), Go (Gin), Rust (Actix-web), Java (Spring Boot)など
        - **データベース**
            - PostgreSQL, MySQL, SQLite, DynamoDB, MongoDBなど
        - **デプロイ環境**
            - AWS (EC2/Lambda), Google Cloud Platform (Cloud Functions), Docker, Static Hosting Servicesなど
- **コーディング支援**
    - AIコーディングエージェントの使用を前提とする。すべてのコード、テスト、ドキュメントは、エージェントが生成すること。

## 2. 機能要件

### 2.1. フロントエンド (クライアント側)
- **UIコンポーネント**
    - 単一のページ内に以下のコンポーネントを配置する。
        - **投稿フォーム**
            - 投稿内容を入力するためのテキストエリアと、投稿を実行するためのボタン（`Submit`）を持つ。
        - **投稿リスト**
            - 既存のすべての投稿を、新しい順にリスト形式で表示する。
            - 各投稿には、**編集ボタン**（`Edit`）と**削除ボタン**（`Delete`）を配置する。
            - 編集ボタンをクリックすると、その投稿がテキストエリアに読み込まれ、編集モードに切り替わる。
            - 編集モード中は、投稿フォームのボタンが**保存ボタン**（`Save`）に変更される。
- **動作**
    - **一覧表示**
        - ページロード時に、既存のすべての投稿をバックエンドAPIから取得し、表示する。
    - **新規投稿**
        - 投稿フォームのSubmitボタンをクリックすると、テキストエリアの内容をバックエンドAPIに送信する。
        - 投稿が成功した場合、UIを再描画して、最新の投稿がリストに追加されていることを確認する。
    - **編集**
        - 編集ボタンをクリックすると、その投稿の内容をテキストエリアに読み込み、フォームを編集モードに切り替える。
        - 保存ボタンをクリックすると、編集内容をバックエンドAPIに送信し、投稿を更新する。
        - 更新が成功した場合、UIを再描画する。
    - **削除**
        - 削除ボタンをクリックすると、確認ダイアログを表示し、ユーザーが確認した場合にバックエンドAPIに削除リクエストを送信する。
        - 削除が成功した場合、UIを再描画して、該当の投稿が削除されていることを確認する。
    - **フィードバック**
        - 送信中のボタンの状態を「送信中...」のように変更するなど、ユーザーにフィードバックを提供すること。

### 2.2. バックエンド (APIサーバー)
- **APIエンドポイント**
    - RESTfulなCRUD操作を完全にサポートする。
    - **POST /api/posts**
        - 投稿を新規作成するエンドポイント。
        - **リクエスト**：JSON形式で`{"content": "投稿内容"}`を受け取る。
        - **レスポンス**
            - 成功時
                - ステータスコード：`201 Created`
                - レスポンス例：`{"id": 1, "content": "内容", "createdAt": "日時", "updatedAt": "日時"}`
            - 失敗時
                - ステータスコード：`400 Bad Request`
                - レスポンス例：`{"error": "content は空にできません"}`
    - **GET /api/posts**
        - すべての投稿を取得するエンドポイント。
        - **リクエスト**：なし
        - **レスポンス**
            - 成功時
                - ステータスコード：`200 OK`
                - レスポンス例：`[{"id": 1, "content": "内容", "createdAt": "日時", "updatedAt": "日時"}]`
    - **GET /api/posts/:id**
        - 特定のIDの投稿を取得するエンドポイント。
        - **リクエスト**：URLパラメータで投稿IDを指定する
        - **レスポンス**
            - 成功時
                - ステータスコード：`200 OK`
                - レスポンス例：`{"id": 1, "content": "内容", "createdAt": "日時", "updatedAt": "日時"}`
            - 失敗時
                - ステータスコード：`404 Not Found`
                - レスポンス例：`{"error": "投稿が見つかりません"}`
    - **PUT /api/posts/:id**
        - 特定のIDの投稿を更新するエンドポイント。
        - **リクエスト**：URLパラメータで投稿IDを指定し、JSON形式で`{"content": "更新後の投稿内容"}`を受け取る
        - **レスポンス**
            - 成功時
                - ステータスコード：`200 OK`
                - レスポンス例：`{"id": 1, "content": "更新後の内容", "createdAt": "日時", "updatedAt": "更新日時"}`
            - 失敗時
                - ステータスコード：`400 Bad Request`
                - レスポンス例：`{"error": "content は空にできません"}`
                - ステータスコード：`404 Not Found`
                - レスポンス例：`{"error": "投稿が見つかりません"}`
    - **DELETE /api/posts/:id**
        - 特定のIDの投稿を削除するエンドポイント。
        - **リクエスト**：URLパラメータで投稿IDを指定する
        - **レスポンス**
            - 成功時
                - ステータスコード：`204 No Content`
            - 失敗時
                - ステータスコード：`404 Not Found`
                - レスポンス例：`{"error": "投稿が見つかりません"}`
- **ロジック**
    - データベースに接続し、データの読み書きを行うこと。
    - 投稿の作成・更新時、`content`が空でないことを検証すること。
    - 更新・削除時、指定されたIDの投稿が存在することを検証すること。
    - 更新時、`updatedAt`フィールドを現在の日時に自動更新すること。

## 3. 技術要件

- **プロジェクト構成**
    - 使用する言語やフレームワーク、ライブラリでベストプラクティスされているディレクトリ構成があればそれに従うこと
        - 一般的な利用方法を学ぶため、できればこちらが望ましい。
    - 一般的なプロジェクト構成が定まっていなければ、学習するときに各レイヤーをたどりやすいので、以下のようなディレクトリ構成にすること。
        - `front`ディレクトリにフロントエンドのコードを配置する。
        - `server`ディレクトリにバックエンドのコードを配置する。
        - `database`ディレクトリにデータベースのスキーマファイル（SQLなど）を配置する。
- **データベーススキーマ**
    - `posts`という名前のテーブルを作成する。
    - カラム
        - `id`：主キー、自動採番（シーケンシャル、uuidv7など採番体型はユーザーに確認すること）
        - `content`：テキスト
        - `createdAt`：登録日時、自動生成
        - `updatedAt`：更新日時、自動生成
- **テスト**
    - **必須**
        - **バックエンド**
            - すべてのAPIエンドポイントが正しく動作することを検証する単体テスト・統合テストを記述すること。
                - 対象：POST, GET（全件・単件）, PUT, DELETE
            - 正常系：各エンドポイントが正しくデータを作成・取得・更新・削除できること
            - 異常系：存在しないIDへのアクセス、空のcontentでの作成・更新などを検証すること
            - テストは全て成功すること（全クリア必須）
        - **フロントエンド**
            - 投稿フォームの動作、投稿リストの表示、編集・削除機能を検証するコンポーネントテストを記述すること。
            - 新規投稿、投稿一覧表示、編集ボタン・保存ボタンの動作、削除ボタンの動作を検証すること。
            - テストは全て成功すること（全クリア必須）
    - **推奨**
        - **E2Eテスト**
            - 選択した技術スタックで成熟したE2Eテストツールが存在する場合は実装すること。
            - ユーザーが投稿を作成・閲覧・編集・削除できる一連のフローを検証すること。
    - **テストツール選定**
        - 技術スタックに応じて適切なテストツール・ライブラリを選択すること。
        - 選択した技術スタックでテストツールが不十分な場合は、実装前にユーザーに報告し、代替案を提案すること。
    - **テスト観点リスト**
        - 技術スタック非依存
        - 以下は最低限の共通テスト観点である。実際の開発では、プロジェクトの仕様や技術スタックに応じて、必要なテストケースを柔軟に追加すること。
        - **バックエンド API テスト**
            - **POST /api/posts**
                - 正常系：有効なcontentで投稿を作成できること
                - 正常系：作成した投稿のidが返却されること
                - 正常系：createdAtとupdatedAtが設定されること
                - 異常系：空のcontentで400エラーが返ること
                - 異常系：不正なJSON形式で400エラーが返ること
            - **GET /api/posts**
                - 正常系：全ての投稿を取得できること
                - 正常系：投稿が新しい順にソートされていること
                - 正常系：投稿が0件の場合も空配列を返すこと
            - **GET /api/posts/:id**
                - 正常系：指定IDの投稿を取得できること
                - 異常系：存在しないIDで404エラーが返ること
            - **PUT /api/posts/:id**
                - 正常系：有効なcontentで投稿を更新できること
                - 正常系：updatedAtが更新されること
                - 正常系：createdAtは変更されないこと
                - 異常系：空のcontentで400エラーが返ること
                - 異常系：存在しないIDで404エラーが返ること
            - **DELETE /api/posts/:id**
                - 正常系：指定IDの投稿を削除できること
                - 正常系：削除後にGETで取得できないこと
                - 異常系：存在しないIDで404エラーが返ること
                - 異常系：削除済みIDで再度削除すると404エラーが返ること
        - **フロントエンド コンポーネントテスト**
            - **投稿フォーム**
                - テキストエリアに入力できること
                - Submitボタンをクリックすると投稿が送信されること
                - 送信中は「送信中...」などの状態表示がされること
                - 投稿成功後、テキストエリアがクリアされること
                    - 推奨
            - **投稿リスト**
                - ページロード時に投稿一覧が表示されること
                - 投稿が新しい順に表示されること
                - 各投稿にEditとDeleteボタンが表示されること
            - **編集機能**
                - Editボタンをクリックすると、テキストエリアに内容が読み込まれること
                - ボタンが「Save」に変更されること
                - Saveボタンで投稿が更新されること
                - 更新後、リストに変更内容が反映されること
            - **削除機能**
                - Deleteボタンをクリックすると確認ダイアログが表示されること
                - 確認後、投稿が削除されること
                - 削除後、リストから該当の投稿が消えること
                - キャンセル時は削除されないこと
        - **E2Eテスト**
            - 推奨
            - ユーザーが投稿を作成→一覧表示→編集→削除できる一連のフローが動作すること
- **ドキュメンテーション**
    - `README.md`ファイルに、プロジェクトのセットアップ方法、開発サーバーの起動方法、テストの実行方法を記述すること。
    - **追加設計ドキュメント**
        - ユーザーからの指示があった場合のみ作成すること。
            - 画面設計書、詳細API設計書、テーブル定義書、ER図、画面遷移図など
        - 必要なドキュメントは状況に応じて選択すること。
            - 画面のみ変更する場合は画面設計書のみ

## 4. デプロイ要件

- **基本方針**
    - このアプリケーションは主にローカル環境での技術検証を目的とする。
- **ローカル開発環境**
    - バックエンドとフロントエンドがローカルで起動し、動作確認できる構成にすること。
    - データベースもローカル環境（または Docker コンテナ）で動作すること。
- **オプション**
    - ユーザーから明示的に要求があった場合のみ、以下をサポートすること。
        - **CI/CDパイプライン**：GitLab CI/CD、GitHub Actions などを使用した自動テスト実行環境の構築
        - **本番環境デプロイ**：指定されたクラウド環境（AWS、GCP など）へのデプロイ構成
