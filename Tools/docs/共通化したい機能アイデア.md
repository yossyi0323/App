# 共通化したい機能・アイデアメモ

## メモ
- まずはアイデア段階。実装は今後の検討事項。
- 他にも思いついたらどんどん追記していく。 

## マスタデータ管理ツール
- 管理者がブラウザからアクセスし、Excel/CSVでダウンロード・アップロードして編集できるWeb管理画面
- 複数のアプリで共通利用できるAPIサーバー機能
- 認証・権限管理、履歴管理、ロールバック機能なども将来的に検討

## ユーザーアカウント管理のテンプレート
- アプリごとにいちいちユーザーや組織、権限の管理、認証機能との連動を考えなくて済むようにしたい。
- そこを工夫したいという要件とか、学習目的に含めてないアプリでは、いつものお決まりのパターンとして使えるテンプレがあると嬉しい。

### 具体的なテンプレのイメージ
- 認証
	- 好みだが、基本Google認証を使いたい。
	- 今はまだで将来的にはだけど、複数のサービスを展開したらSSOも対応できるようにしたい。
- データベース
	- 認証やユーザー管理とかのテンプレートを動かす、お決まりのテーブル定義をいろんなアプリで使いまわしたい。
	- なるべくシンプル（高度に正規化した）なテーブルで定義しておきたい。
	- テンプレートに倣うアプリを開発するときにも、柔軟に他テーブルとの結合やカラムの拡張ができるようにはしておきたい。
- ユーザー管理
	- DMLだけでなく、管理者ユーザーが画面からアカウントを作成・変更・削除可能
	- アカウントを持つユーザーが、自身の情報を権限の範囲内で設定可能
		- メール送信先のメールアドレスとか、アプリでの表示名とか。
	- 
- 組織管理
	- 多数のユーザーに対して、ユーザーが属する複数の組織体（ユーザーグループ）を管理可能とする。
- 権限管理
	- 


## その他の共通化したい機能
- REST API自動生成ツール
- 汎用的な自動保存ユーティリティ
- 論理名・物理名変換ツール
- データベース管理支援ツール
- 状態管理の共通仕組み
- **A5:SQL Mk-2 (.a5er) → Mermaid ER図変換ツール**
	- .a5erファイルをパースしてMermaid形式のER図を自動生成
	- Git管理している.a5erから自動でObsidian用のER図.mdを生成
	- テーブル定義書もMarkdown形式で出力できると便利

## 汎用CRUD APIサービス（将来の妄想）
- **コンセプト**: DDLだけ実行すれば、全テーブルのCRUD APIが自動で使える
- **仕組み**: PostgreSQLの`information_schema`からメタデータを読み取り、動的にAPIを提供
- **使い方イメージ**:
	```
	DDL実行 → テーブル作成
	  ↓
	ツール起動（DB接続情報のみ設定）
	  ↓
	GET /api/crud/m_user
	POST /api/crud/m_user
	PUT /api/crud/m_user/1
	DELETE /api/crud/m_user/1
	が自動で使える
	```
- **課題**:
	- SQLインジェクション対策（ホワイトリスト必須）
	- 楽観ロック・排他制御は別途実装が必要
	- ビジネスロジック（ステータス連動など）は挟めない
	- 既存ツール（PostgREST、Hasura、Supabase）と似たコンセプト
- **参考**:
	- PostgREST: https://postgrest.org/
	- Hasura: https://hasura.io/
	- Supabase: https://supabase.com/
- **備考**: 単純CRUDのボイラープレート削減には有用だが、複雑な業務ロジックは結局手書きが必要

## Java ⇄ TypeScript 型変換ツール
- **Java → TypeScript**: typescript-generator（Mavenプラグイン）で実用的
	- 精度高い、enum対応、ネスト対応
	- 検証済み: App/typescript-generator-sample/
	- 課題: 生成したTypeScriptファイルをフロントエンドにコピーする手間が面倒
- **TypeScript → Java**: 直接変換ツールはほぼなし
	- JSON Schema経由なら可能（typescript-json-schema → jsonschema2pojo）
	- 手動変換が現実的
- **結論**: nextday-operations-prepareでは手動で型定義を書く方が楽

